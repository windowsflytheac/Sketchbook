<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sketchbook 3D All Builds Simulator</title>

<!-- League Gothic font -->
<link href="https://fonts.googleapis.com/css2?family=League+Gothic&display=swap" rel="stylesheet" />

<style>
body, html {
  margin: 0; padding: 0; height: 100%;
  background: #222;
  font-family: 'League Gothic', monospace;
  color: white;
  overflow: hidden;
}
#valveIntro {
  position: fixed; top:0; left:0;
  width: 100vw; height: 100vh;
  object-fit: cover;
  background: black;
  z-index: 10000;
}
#enableSoundOverlay {
  position: fixed; inset:0;
  background: rgba(0,0,0,0.8);
  color: #f1a20f;
  display: flex; justify-content:center; align-items:center;
  font-size:2rem; cursor:pointer;
  z-index:12000;
}
#menuOverlay {
  position: fixed; top: 10vh; left:50%; transform:translateX(-50%);
  background:#333; padding:1rem 2rem;
  border-radius:6px; box-shadow:0 0 12px #f1a20f;
  color:#f1a20f; z-index:9000;
}
#menuOverlay button, select {
  background:transparent; border:2px solid #f1a20f;
  color:#f1a20f; padding:0.5rem 1.5rem; margin:0.5rem 0.5rem 0 0;
  cursor:pointer; border-radius:4px;
}
#menuOverlay button:hover, select:hover {
  background:#f1a20f; color:#000;
}
#console {
  position: fixed; bottom:0; left:0; right:0;
  max-height:40%; background: rgba(0,0,0,0.85);
  display:none; flex-direction:column; padding:10px;
  overflow-y:auto; z-index:11000;
}
#console-output { flex-grow:1; overflow-y:auto; white-space:pre-wrap; font-size:14px; margin-bottom:5px; }
#console-input {
  font-family: 'League Gothic', monospace;
  font-size:14px; border:none; background:black;
  color:#f1a20f; outline:none; padding:5px;
  width:100%; box-sizing:border-box;
}
#threejsLabel {
  position: fixed; top:8px; right:12px;
  font-family:'League Gothic', monospace; color:#f1a20f;
  font-size:0.85rem; z-index:13000; user-select:none;
  pointer-events:none; text-shadow:0 0 4px #f1a20f;
}
#lobbyOverlay {
  display:none; position:fixed; top:20vh; left:50%;
  transform:translateX(-50%);
  background:#333; padding:1rem 2rem; border-radius:6px;
  box-shadow:0 0 12px #f1a20f; color:#f1a20f;
  z-index:14000; width:300px;
}
#lobbyOverlay h2 { margin-top:0; font-size:1.2rem; }
#lobbyOverlay input, #lobbyOverlay button { font-size:1rem; margin-top:0.5rem; width:100%; box-sizing:border-box; }
#lobbyStatus { margin-top:10px; font-size:0.9rem; min-height:1.5em; white-space:pre-wrap; }
#escapeOverlay {
  display:none; position:fixed; top:10vh; left:50%;
  transform:translateX(-50%);
  background:#333; padding:1rem 2rem; border-radius:6px;
  box-shadow:0 0 12px #f1a20f; color:#f1a20f;
  z-index:15000; width:320px;
}
#escapeOverlay h2 { margin-top:0; font-size:1.2rem; }
#escapeOverlay select { width:100%; margin-top:0.5rem; padding:0.5rem; background:#222; color:#f1a20f; border:2px solid #f1a20f; border-radius:4px; font-family:'League Gothic', monospace; }
#escapeOverlay button { width:100%; margin-top:0.5rem; padding:0.5rem; background:#f1a20f; color:#000; border:none; border-radius:4px; cursor:pointer; }
</style>
</head>
<body>

<video id="valveIntro" autoplay muted playsinline>
  <source src="valveintro.mp4" type="video/mp4">
  Your browser does not support video.
</video>
<audio id="valveIntroAudio" src="valveintro_sound.mp3"></audio>
<div id="enableSoundOverlay">Click to enable sound</div>

<div id="menuOverlay">
  <button id="startGameBtn">Start Game</button>
  <button id="loadSaveBtn">Load Save</button>
  <button id="showLobbyBtn">Multiplayer Lobby</button>
</div>

<div id="lobbyOverlay">
  <h2>Multiplayer Lobby</h2>
  <input id="roomInput" type="text" placeholder="Room name" />
  <button id="joinRoomBtn">Join Room</button>
  <button id="closeLobbyBtn">Close</button>
  <div id="lobbyStatus"></div>
</div>

<div id="console">
  <div id="console-output"></div>
  <input id="console-input" autocomplete="off" spellcheck="false" placeholder="Enter command..." />
</div>

<div id="threejsLabel">Three.js: Source Simulator</div>

<div id="escapeOverlay">
  <h2>Select Build Version</h2>
  <select id="versionSelect"></select>
  <button id="loadVersionBtn">Load Version</button>
</div>

<script>
  // All builds including skipped/patch versions
  const allBuilds = [
    {key:'v1', label:'Version 1'},
    {key:'v2', label:'Version 2'},
    {key:'v3', label:'Version 3'},
    {key:'alpha_0.12', label:'Alpha 0.12 (No weapons)'},
    {key:'beta_2.7', label:'Beta 2.7'},
    {key:'beta_3.2', label:'Beta 3.2'},
    {key:'beta_13', label:'Beta 13'},
    {key:'beta_18.2', label:'Beta 18.2'},
    {key:'beta_24.2', label:'Beta 24.2 (Full weapons)'},
    {key:'sketchbook3d', label:'Sketchbook 3D'},
    {key:'beta_25.1', label:'Beta 25.1'},
    // add remaining builds/patches up to 25.x as needed
  ];

  const valveIntro = document.getElementById('valveIntro');
  const valveIntroAudio = document.getElementById('valveIntroAudio');
  const soundOverlay = document.getElementById('enableSoundOverlay');
  const menuOverlay = document.getElementById('menuOverlay');
  const consoleEl = document.getElementById('console');
  const consoleOutput = document.getElementById('console-output');
  const consoleInput = document.getElementById('console-input');
  const threejsLabel = document.getElementById('threejsLabel');
  const escapeOverlay = document.getElementById('escapeOverlay');
  const versionSelect = document.getElementById('versionSelect');
  const loadVersionBtn = document.getElementById('loadVersionBtn');

  let weaponGroup = null;
  let world = null;
  let consoleActive = false;
  let currentBuildKey = null;

  // Populate version select menu
  allBuilds.forEach(b=>{
    const option = document.createElement('option');
    option.value=b.key;
    option.textContent=b.label;
    versionSelect.appendChild(option);
  });

  soundOverlay.addEventListener('click', ()=>{
    valveIntro.muted=false; valveIntro.play(); valveIntroAudio.play();
    soundOverlay.style.display='none';
  });

  // Spacebar to skip Valve intro
  window.addEventListener('keydown', e=>{
    if(e.code==='Space'){ 
      valveIntro.pause(); valveIntro.style.display='none'; menuOverlay.style.display='block'; 
    }
    if(e.code==='Escape'){ toggleEscapeMenu(); }
  });

  valveIntro.onended = ()=>{
    valveIntro.style.display='none';
    menuOverlay.style.display='block';
  };

  function toggleEscapeMenu(){
    escapeOverlay.style.display = escapeOverlay.style.display==='block'?'none':'block';
  }

  loadVersionBtn.onclick = ()=>{ 
    const buildKey = versionSelect.value;
    loadBuild(buildKey);
    toggleEscapeMenu();
  };

  function logToConsole(msg){
    consoleOutput.textContent+=msg+'\n';
    consoleOutput.scrollTop=consoleOutput.scrollHeight;
    console.log(msg);
  }

  // Console toggle
  window.addEventListener('keydown', e=>{
    if(e.key==='`'||e.key==='~'){ consoleActive=!consoleActive; consoleEl.style.display=consoleActive?'flex':'none'; if(consoleActive)consoleInput.focus(); }
  });

  consoleInput.addEventListener('keydown', e=>{
    if(e.key==='Enter'){ 
      const cmd=consoleInput.value.trim(); consoleInput.value=''; logToConsole('> '+cmd); handleCommand(cmd); e.preventDefault();
    }
  });

  function handleCommand(cmd){
    const c=cmd.toLowerCase();
    if(c==='toggleportalgun'){ if(weaponGroup){ weaponGroup.visible=!weaponGroup.visible; logToConsole(`Portal gun ${weaponGroup.visible?'enabled':'disabled'}`); } }
    else if(c==='help'){ logToConsole('Commands: toggleportalgun, help'); }
    else logToConsole(`Unknown command: ${cmd}`);
  }

  // Load Build function (simulated)
  function loadBuild(buildKey){
    currentBuildKey = buildKey;
    threejsLabel.textContent = allBuilds.find(b=>b.key===buildKey)?.label||'Unknown Build';
    menuOverlay.style.display='none';

    // Remove old world/weaponGroup
    if(world){ world.scene.clear(); weaponGroup=null; world=null; }

    // Initialize world (sketchbook.min.js or placeholder)
    if(buildKey==='sketchbook3d'){
      world = {scene:new THREE.Scene(), camera:new THREE.PerspectiveCamera(), addWeapon:(w)=>{}}; 
      logToConsole('Loaded Sketchbook 3D base game.');
    } else {
      world = {scene:new THREE.Scene(), camera:new THREE.PerspectiveCamera()};
      weaponGroup = new THREE.Group();
      world.camera.add(weaponGroup);
      world.scene.add(world.camera);
      weaponGroup.position.set(0.5,-0.7,-1);
      weaponGroup.visible=true;

      // Simulate weapons/models; fallback to red ERROR if not available
      const modelAvailable = ['beta_24.2','sketchbook3d','beta_25.1']; // only "stable" versions
      if(!modelAvailable.includes(buildKey)){
        const geometry = new THREE.BoxGeometry(1,1,1);
        const material = new THREE.MeshBasicMaterial({color:0xff0000});
        const errorModel = new THREE.Mesh(geometry,material);
        weaponGroup.add(errorModel);
      } else {
        // Load actual model placeholders
        const geometry = new THREE.BoxGeometry(0.5,0.5,1);
        const material = new THREE.MeshBasicMaterial({color:0x00ff00});
        const portalGun = new THREE.Mesh(geometry,material);
        weaponGroup.add(portalGun);
      }

      logToConsole(`Loaded build: ${buildKey}`);
    }
  }

  document.getElementById('startGameBtn').onclick=()=>{ loadBuild(versionSelect.value); menuOverlay.style.display='none'; };
</script>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
</body>
</html>
